# Review the consistency of the Technical Design and codebase

<REFERENCES>
TECHNICAL_DESIGN_COMPONENTS: @docs/5.3_components.md
TECHNICAL_DESIGN_COMPONENTS_YAML: @docs/5.3_components.yaml
TECHNICAL_DESIGN_TRANSACTIONS: @docs/5.3_transactions.yaml
IMPLEMENTATION_PLAN: @docs/Phase<phase_number>/6.1_implementation_plan.md
RUNNING_SERVICES: @docs/common/running-services.md
TESTING_PREFERENCES: @docs/common/testing-preferences.md
</REFERENCES>

Read carefully all three Technical Design files:

- `docs/5.3_components.md` - Component architecture diagrams
- `docs/5.3_components.yaml` - Component registry with handlers and DTOs
- `docs/5.3_transactions.yaml` - Transaction flows between components

You have to find all inconsistencies in the Technical Design files and fix them. You must ensure that Technical Design and codebase are coherent, correct and absolutely impeccable. It must contain no discrepancies, be free of any errors and have no any statements that would require any clarification before passing to the code implementation step.

Always validate component references through AI review after making changes to ensure component references are consistent.

Implement the tasks #ARGUMENTS of these (WARN! pay attention only to the Task #ARGUMENTS) :

## Task 1 - Component Reference Validation

### Run automated validation

Perform AI review to check for component reference consistency between the three Technical Design files.

### Fix validation errors

Address any issues found during validation:

- ✗ Missing components referenced in transactions.yaml but not found in components.yaml
- ⚠ Unused components defined in components.yaml but not referenced in transactions.yaml

## Task 2 - Component Naming and IDs consistency

### Check component ID format

Verify all component IDs follow the format: `{domain}.{layer}.{number}.{name}`

Examples:

- `auth.frontend.1.LoginForm`
- `auth.backend.2.AuthService`
- `auth.shared.1.UserDTO`

### Internal consistency check

Look at each component in `components.yaml` and check if the IDs and names are used consistently throughout all three Technical Design files:

- `components.md` - Component descriptions and Mermaid diagrams
- `components.yaml` - Component registry
- `transactions.yaml` - Transaction flows

### Consistency with codebase

After ensuring internal consistency, examine the codebase and find any component names that are not consistent with the Technical Design. Remove any discrepancy in code and comments with the Technical Design.

## Task 3 - Handler and DTO consistency

### Handler ID format check

Verify all handler IDs follow the format: `H-{component_id}.{handler_name}`

Examples:

- `H-auth.frontend.1.HandleSubmit`
- `H-auth.backend.2.ValidateCredentials`

### Cross-reference check

For each handler in `components.yaml`:

- Verify the component exists
- Check input/output DTO references are valid
- Ensure handlers referenced in `transactions.yaml` exist in `components.yaml`

### DTO consistency check

Verify all DTOs:

- Are properly defined in `components.yaml` under the `dto` section
- Have consistent field names and types across all references
- Are correctly referenced by handlers and components

## Task 4 - Transaction Flow consistency

### Transaction flow validation

For each transaction in `transactions.yaml`:

- Verify all referenced components exist in `components.yaml`
- Check all referenced handlers exist for their respective components
- Validate input/output DTO flows between steps
- Ensure error handling references valid components

### Flow completeness check

Ensure each transaction has:

- Clear trigger description
- Complete step-by-step flow
- Proper error handling
- Defined success criteria

## Task 5 - Visual vs Structural consistency

### Mermaid diagram consistency

Compare `components.md` Mermaid diagrams with `components.yaml` structure:

- Verify all components in diagrams exist in YAML registry
- Check component names and descriptions match
- Ensure layer organization is consistent

## Final Report

After you have fixed all inconsistencies in the Technical Design files, create a final report in the file `docs/reports/5.3_technical_design_lint_report.md` (append if exists) describing:

1. All work performed
2. Components, handlers, DTOs, and transactions checked
3. Inconsistencies found and fixed
4. Validation results (before and after fixes)
5. Any remaining issues or recommendations

Always end with a final validation to confirm all issues are resolved.
