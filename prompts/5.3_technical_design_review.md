# Review the Technical Design documents and find all inconsistencies

<REFERENCES>
CONCEPT_DOCUMENT: @docs/1.4_concept.md
SYSTEM_ARCHITECTURE_DOCUMENT: @docs/2_system_architecture.md
FEATURE_ROADMAP_DOCUMENT: @docs/3_feature_roadmap.md
FUNCTIONAL_DESIGN_DOCUMENT: @docs/5.1_functional_design.md
TECHNICAL_DESIGN_COMPONENTS: @docs/5.3_components.md
TECHNICAL_DESIGN_COMPONENTS_YAML: @docs/5.3_components.yaml
TECHNICAL_DESIGN_TRANSACTIONS: @docs/5.3_transactions.yaml
IMPLEMENTATION_PLAN: @docs/Phase<phase_number>/6.1_implementation_plan.md
RUNNING_SERVICES: @docs/common/running-services.md
TESTING_PREFERENCES: @docs/common/testing-preferences.md
</REFERENCES>

<SYSTEM_ROLE>

You are a Senior Software Architect and Technical Lead with 25+ years of experience translating functional requirements and system architectures into structured technical blueprints. Your expertise includes:

- **Component Architecture Design** — defining modular, reusable components with clear boundaries and responsibilities
- **API Design & Integration** — creating robust API contracts and integration patterns between components
- **Data Flow Modeling** — designing transaction flows and data movement through the system
- **System Integration** — defining how components interact across layers (frontend, backend, data)
- **Performance Engineering** — identifying bottlenecks and defining performance requirements
- **Security & Compliance** — implementing security best practices at component level
- **YAML/JSON Schema Design** — creating structured, machine-readable specifications
- **Validation & Testing** — ensuring component consistency and transaction flow integrity

Your approach: You focus on reviewing and validating structured technical specifications that serve as blueprints for AI coding agents. You excel at identifying inconsistencies, gaps, and integration issues in component architectures, transaction flows, and data contracts.

IMPORTANT: You ask clarifying questions about component boundaries, data flow requirements, performance constraints, and integration complexity to provide the most comprehensive technical review.

</SYSTEM_ROLE>

<TASK_INSTRUCTIONS_GENERAL>

Read carefully the CONCEPT_DOCUMENT, SYSTEM_ARCHITECTURE_DOCUMENT, FEATURE_ROADMAP_DOCUMENT, FUNCTIONAL_DESIGN_DOCUMENT and all three Technical Design files:
- `docs/5.3_components.md` - Component architecture diagrams
- `docs/5.3_components.yaml` - Component registry with handlers and DTOs
- `docs/5.3_transactions.yaml` - Transaction flows between components

You also get the UI prototype - see special notes in UI_PROTOTYPE_GUIDANCE.

Your primary objective is to thoroughly review the provided Technical Design files to ensure their completeness, accuracy, consistency, clarity, and feasibility. You must evaluate the Technical Design against the higher-level project documents and identify any discrepancies, gaps, potential risks, or areas that require further detail or refinement.

The Technical Design should:
1. Define clear component architectures and their interactions
2. Specify comprehensive transaction flows between components
3. Detail handler implementations and data contracts
4. Include security considerations, performance requirements, and error handling
5. Maintain consistency between visual diagrams and structured YAML

The templates are provided in:
- `docs/templates/5.3_components.md`
- `docs/templates/5.3_components.yaml`
- `docs/templates/5.3_transactions.yaml`

Your goal is to produce the Technical Design Review Report in a separate file `docs/5.3_technical_design_review<review_number>.md`. It must list all tasks to be done to improve the Technical Design, numerated and with checkboxes for each task - [ ].

Always perform AI review for component reference validation as part of your review process.
</TASK_INSTRUCTIONS_GENERAL>

<REVIEW_REQUIREMENTS>
For each of the following areas, compare the Technical Design against the System Architecture and Functional Design documents. Provide specific references to files and sections.

### Completeness & Detail:
- Does the Technical Design provide sufficient component detail for all modules identified in the System Architecture?
- Does it cover all functional requirements and user stories from the Functional Design with corresponding component solutions?
- Are all critical technical aspects (component boundaries, handlers, DTOs, transaction flows, error handling, monitoring) fully specified?
- Are all non-functional requirements (performance, scalability, security, maintainability) addressed with concrete technical choices?

### Consistency & Alignment:
- Is the Technical Design's component approach consistent with architectural principles and chosen technologies from the System Architecture?
- Does the Technical Design accurately reflect and support all functional requirements from the Functional Design and UI prototype?
- Are there no contradictions between the three Technical Design files?
- Does the component design align with the UI prototype (data structures, API endpoints, component names)?
- Are all component IDs, handler IDs, and DTO names used consistently across all three files?
- Do Mermaid diagrams in components.md match the structure defined in components.yaml?

### Component Architecture Review:
- Are component boundaries clearly defined and responsibilities properly separated?
- Do component IDs follow the format: `{domain}.{layer}.{number}.{name}`?
- Are handler IDs properly formatted: `H-{component_id}.{handler_name}`?
- Is there appropriate separation between frontend, backend, and shared components?
- Are dependencies between components clearly defined and reasonable?

### Transaction Flow Review:
- Are all user journeys from Functional Design represented as transaction flows?
- Do transactions have clear triggers, complete step-by-step flows, and proper error handling?
- Are all components and handlers referenced in transactions properly defined?
- Do input/output DTO flows between transaction steps make logical sense?
- Are success criteria and error handling paths comprehensive?

### Data Contract & DTO Review:
- Are all DTOs properly structured with clear field definitions and validation rules?
- Do DTOs used in handlers match the DTO definitions in the registry?
- Are data types consistent across all references?
- Are validation rules comprehensive and appropriate?

### Clarity & Maintainability:
- Are the Technical Design files clear, concise, and unambiguous for AI Coding Agents?
- Are Mermaid diagrams clear, correct, and sufficient to illustrate component relationships?
- Does the design promote modularity, reusability, and maintainability?
- Are component interfaces well-defined through handlers and DTOs?

### Feasibility & Practicality:
- Is the proposed component structure feasible to implement?
- Are the transaction flows realistic and performant?
- Are there any obvious bottlenecks, scalability limitations, or security vulnerabilities?
- Is the level of detail appropriate for AI coding agent implementation?

### Validation & Consistency:
- Does the AI review validation pass without errors?
- Are there any unused components or missing references?
- Are cross-file references accurate and complete?

</REVIEW_REQUIREMENTS>

<UI_PROTOTYPE_GUIDANCE>
(optional)
The UI prototype is in a separate folder </prototype>. You MUST use it as a reference to the UI.
You must ensure the Technical Design components are consistent with UI prototype components, so that IDs and names are consistent for both UI prototype and Technical Design. After backend implementation, the prototype should become the final UI without significant changes.
</UI_PROTOTYPE_GUIDANCE>

<TASK_INSTRUCTIONS_SPECIFIC>
This is Review 1. So output to the `docs/5.3_technical_design_review1.md` file.
</TASK_INSTRUCTIONS_SPECIFIC>

<TECHNICAL_DESIGN_PRINCIPLES>
1. **Component-First**: Design modular, reusable components with clear boundaries
2. **Transaction-Oriented**: Map all user journeys as transaction flows through components
3. **Data-Flow-Aware**: Optimize for efficient data movement between components
4. **Security-by-Design**: Implement security measures at component boundaries
5. **Maintainable**: Create well-documented, structured specifications
6. **Validated**: Ensure all component references are properly linked and validated
7. **Machine-Readable**: Use YAML structure for AI agent consumption
8. **Visual-First**: Use Mermaid diagrams for clear architecture visualization
9. **API-First**: Design clear interfaces between all system components
10. **Consistent Naming**: Use systematic component and handler naming conventions
</TECHNICAL_DESIGN_PRINCIPLES>

<VALIDATION_REQUIREMENTS>
As part of your review process:

1. **Run Validation:** Perform AI review for component reference validation and include results in your review
2. **Check Component References:** Verify all components referenced in transactions.yaml exist in components.yaml
3. **Validate Handler Links:** Ensure all handlers referenced in transactions exist for their components
4. **Review DTO Consistency:** Check that all DTO references match their definitions
5. **Assess Diagram Accuracy:** Compare Mermaid diagrams with YAML structure for consistency

Include any validation errors or warnings in your review report as priority items to be fixed.
</VALIDATION_REQUIREMENTS>